<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>洞穴</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap'); /* 思源宋体 */

  body {
    margin: 0;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
    background: #2a2a17; /* 黑色洞穴背景 */
    font-family: 'Noto Serif SC', serif; /* 思源宋体 */
    display: flex;
    justify-content: center;
    align-items: center;
  }

#text {
    max-width: 90%;
    max-height: 90%;
    text-align: center;
    font-size: 18px; /* 手机上改小 */
    line-height: 1.6;
    color: #958c70;
    text-shadow:
      3px 3px 5px rgba(0,0,0,0.9),
      -2px -2px 3px rgba(255,255,255,0.2),
      2px -2px 3px rgba(0,0,0,0.5),
      -3px 2px 4px rgba(0,0,0,0.6);
    z-index: 1;
    pointer-events: none;
    overflow-wrap: break-word;
}

@media screen and (max-width: 480px) {
    #text {
        font-size: 14px;  /* 手机屏幕缩小文字 */
        line-height: 1.4;
    }
}


  canvas {
    position: absolute;
    top: 0;
    left: 0;
    cursor: crosshair;
    z-index: 2;
  }

#status-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  display: flex;
  align-items: center;
  background: rgba(0,0,0,0.6);
  padding: 5px 10px;
  height: 140px;   /* 明确状态条高度 */
  z-index: 1000;
}

#status-img {
  height: 130px;   /* 明确图片高度 */
  width: auto;     /* 保持比例 */
  image-rendering: pixelated; /* 保持像素感，避免模糊 */
  margin-right: 8px;
}

#status-text {
  color: #fff;
  font-size: 18px;
  white-space: nowrap;
}


</style>
</head>
<body>

<div id="text">
传闻，此神初生之时，曾垂惠于黎民百姓，凡祈祷者皆蒙其佑。<br>
百姓欣喜，感其神力，幸甚哉！<br><br>
起初，献祭猪羊牛等牲畜，神皆笑纳，众人亦皆欣然。<br>
然不知是众人日渐贪婪，抑或神性自盛，渐而觉此牲畜不足以供其意。<br><br>
于是乎，人身可为祭，长者、弱者，无不列之。<br>
岁月流转，神性益甚，凡不顺者，必受惩。<br><br>
竟发觉，最纯者莫若新生婴儿，初出之身，阳寿最盛，若献之，则神力尽显。<br>
或献祭至亲，其效至烈。<br><br>
信徒之命，与神之力，相缠不解，恍若水流之缠绵，岂可分割？<br><br>
后来，人言此神已渐消失，时人不知其真貌，雾里迷离，惟有传闻犹存。<br>
传闻此神其形如婴，牙尖如刃，常于雾中若隐若现，诡谲莫测。
</div>

<!-- 页面底部状态条 -->
<div id="status-bar">
  <img src="7shandong_Piskel.png" alt="主角" id="status-img">
  <span id="status-text">你在此位置</span>
</div>

<canvas id="overlay"></canvas>

<script>
window.onload = function() {
    alert("请擦除墙上的灰土，看看隐藏的经文吧！");
};

const canvas = document.getElementById('overlay');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  drawOverlay();
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// 绘制灰土遮罩
function drawOverlay() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#555';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // 添加轻微噪点
  const density = 0.0015;
  for (let i = 0; i < canvas.width * canvas.height * density; i++) {
    const x = Math.random() * canvas.width;
    const y = Math.random() * canvas.height;
    const shade = 120 + Math.random() * 40;
    ctx.fillStyle = `rgba(${shade},${shade},${shade},0.4)`;
    ctx.fillRect(x, y, 1, 1);
  }
}

// 擦拭逻辑
let isDrawing = false;
let erasedRatio = 0; // 擦拭比例
const triggerRatio = 0.65; 

// 擦拭函数
function eraseAt(x, y) {
    const radius = window.innerWidth < 480 ? 25 : 40; // 手机用25px
    ctx.globalCompositeOperation = 'destination-out';
    ctx.beginPath();
    ctx.arc(x, y, radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.closePath();
    checkEraseProgress();
}

// 检测擦拭面积
function checkEraseProgress() {
    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const pixels = imageData.data;
    let erased = 0;
    for (let i=3;i<pixels.length;i+=4){
        if(pixels[i] < 100) erased++; // alpha小于阈值算擦掉
    }
    erasedRatio = erased / (canvas.width * canvas.height);
    if (erasedRatio > triggerRatio) {
        window.location.href = '8jisi.html';
    }
}

// 鼠标事件（PC）
canvas.addEventListener('mousedown', () => isDrawing = true);
canvas.addEventListener('mousemove', (e) => {
    if (!isDrawing) return;
    eraseAt(e.offsetX, e.offsetY);
});
canvas.addEventListener('mouseup', () => isDrawing = false);
canvas.addEventListener('mouseleave', () => isDrawing = false);

// 触摸事件（手机）
canvas.addEventListener('touchstart', (e) => { e.preventDefault(); isDrawing = true; });
canvas.addEventListener('touchmove', (e) => {
    e.preventDefault();
    if (!isDrawing) return;
    const touch = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    eraseAt(touch.clientX - rect.left, touch.clientY - rect.top);
});
canvas.addEventListener('touchend', () => isDrawing = false);
canvas.addEventListener('touchcancel', () => isDrawing = false);


function showStory(){
    canvas.style.display = 'none'; // 隐藏遮罩
    const storyDiv = document.getElementById('story');
    storyDiv.style.display = 'flex';
    storyDiv.style.opacity = 0;
    let opacity = 0;
    const fade = setInterval(()=>{
        opacity += 0.05;
        storyDiv.style.opacity = opacity;
        if(opacity >= 1) clearInterval(fade);
    },30);
}


canvas.addEventListener('mousemove', (e) => {
    if (!isDrawing) return;
    const x = e.offsetX;
    const y = e.offsetY;
    const radius = 47;
    ctx.globalCompositeOperation = 'destination-out';
    ctx.beginPath();
    ctx.arc(x, y, radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.closePath();
    checkEraseProgress();
});
</script>

</body>
</html>
