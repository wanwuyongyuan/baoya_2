<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>钥匙开锁</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap');

body {
  margin: 0;
  font-family: 'Noto+Serif+SC', serif;
  background: radial-gradient(circle at center, #3b2f1a 0%, #1e1407 80%);
  color: #f5e7c4;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  line-height: 1.8;
  font-size: 19px;
  user-select: none;
  overflow: hidden;
  padding: 20px;
  box-sizing: border-box;
}

.story {
  max-width: 780px;
  margin-bottom: 60px;
  transition: opacity 0.6s ease;
  min-height: 400px;
}

#key {
  display: inline-block;
  padding: 10px 20px;
  color: #edcb77;
  border: 1px solid rgba(237,203,119,0.5);
  border-radius: 6px;
  cursor: grab;
  background: rgba(60, 47, 26, 0.3);
  transition: transform 0.2s;
}
#key:active {
  cursor: grabbing;
  transform: scale(1.1);
}

#lockhole {
  width: 100px;
  height: 140px;
  border: 2px solid rgba(255,255,200,0.3);
  border-radius: 50px / 70px;
  background: rgba(0,0,0,0.3);
  margin-top: 40px;
  text-align: center;
  line-height: 140px;
  color: rgba(255,255,255,0.2);
  font-size: 14px;
}
#lockhole.glow {
  border-color: #ffd966;
  box-shadow: 0 0 20px #ffd966;
  color: #ffd966;
  transition: 0.5s;
}

.fade-line {
  opacity: 0;
  transform: translateY(4px);
  transition: opacity 0.9s ease, transform 0.6s ease;
}
.fade-line.show {
  opacity: 1;
  transform: translateY(0);
}

#status-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  display: flex;
  align-items: center;
  background: rgba(0,0,0,0.6);
  padding: 5px 10px;
  height: 90px;   /* 明确状态条高度 */
  z-index: 1000;
}

#status-img {
  height: 80px;   /* 明确图片高度 */
  width: auto;     /* 保持比例 */
  image-rendering: pixelated; /* 保持像素感，避免模糊 */
  margin-right: 8px;
}

#status-text {
  color: #fff;
  font-size: 18px;
  white-space: nowrap;
}

</style>
</head>
<body>

<div class="story" id="story">
  <p>那串钥匙在我的掌心。</p>
  <p>我抬起手中的<span id="key" draggable="true">钥匙</span>。</p>
  <p>（将钥匙放入门锁）</p>
</div>

<div id="lockhole">锁孔</div>

<audio id="unlockSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_15f3031b93.mp3?filename=unlock-door-6042.mp3"></audio>

<div id="status-bar">
  <img src="9riji_Piskel.png" alt="主角" id="status-img">
  <span id="status-text">你在此位置（亮光版）</span>
</div>

<script>
const key = document.getElementById('key');
const lockhole = document.getElementById('lockhole');
const story = document.getElementById('story');
const sound = document.getElementById('unlockSound');
const statusImg = document.getElementById('status-img');

key.addEventListener('dragstart', e => {
  e.dataTransfer.setData('text/plain', 'key');
  setTimeout(() => key.style.opacity = '0.5', 0);
});
key.addEventListener('dragend', () => {
  key.style.opacity = '1';
});

lockhole.addEventListener('dragover', e => {
  e.preventDefault();
  lockhole.classList.add('glow');
});
lockhole.addEventListener('dragleave', () => {
  lockhole.classList.remove('glow');
});

lockhole.addEventListener('drop', e => {
  e.preventDefault();
  const data = e.dataTransfer.getData('text/plain');
  if (data === 'key') {
    // 🔹 开锁反馈
    lockhole.innerHTML = '<span style="font-size:20px; color:#ffe89e;">咔哒——</span>';
    sound.play();
    lockhole.classList.remove('glow');

    // 🔹 替换状态条小图
    statusImg.src = '9jisi1_Piskel.png';

    // 🔹 隐藏锁孔 & 淡出原剧情
    lockhole.style.display = 'none';
    story.style.opacity = '0';

    setTimeout(() => {
      story.innerHTML = ''; // 清空旧内容
      const lines = [
        '厚重的铁门缓缓开启。',
        '几道冷风灌入，火光摇曳，映得我们脸色惨白。空气中夹着土和血的腥味，我忍不住咳嗽。',
        '我们小心前行，终于看到了出口的月光。',
        '洞口聚着一群来雾山旅游的VIP老年人，失去了导游的他们不知道下一步该做什么。',
        '小骏低声问我：“奚妍，这里……有你妈妈吗？”',
        '“没有……”我紧握双拳，声音哽咽。',
        '小田上前对我们低声说：“要不我带他们先走？”',
        '这时有些老人也认出了她。',
        '“好，你路感最好。”小徐道。',
        '小田点点头，领着那些 VIP 老年人消失在雾中。',
        '现在只剩我们三人。',
        '<span id="toFinal" style="font-weight:bold; color:#ffd966; cursor:pointer;">我们深吸一口气，重新踏入山洞。</span>'
      ];

      const frag = document.createDocumentFragment();
      lines.forEach(line => {
        const p = document.createElement('p');
        p.className = 'fade-line';
        p.style.textAlign = 'left';
        p.innerHTML = line;
        frag.appendChild(p);
      });
      story.appendChild(frag);

      // 逐行淡入
      requestAnimationFrame(() => {
        const ps = story.querySelectorAll('.fade-line');
        let idx = 0;
        function revealOne() {
          if (idx < ps.length) {
            ps[idx].classList.add('show');
            idx++;
            setTimeout(revealOne, 700);
          } else {
            story.style.minHeight = '';
            const toFinal = document.getElementById('toFinal');
            if (toFinal) {
              const goFinal = () => window.location.href = '10final.html';
              toFinal.addEventListener('click', goFinal);
              toFinal.addEventListener('touchend', goFinal);
            }
          }
        }
        story.style.opacity = '1';
        revealOne();
      });
    }, 500); // 开锁淡出时间
  }
});
</script>

</body>
</html>
