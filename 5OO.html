<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>OO聊天界面</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#eef4fc;
  --panel:#fff;
  --blue:#3399ff;
  --muted:#666;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:'Noto Sans SC','思源黑体','Microsoft YaHei',sans-serif;
  display:flex;
  height:100vh;
  overflow:hidden;
  background:var(--bg);
}
#friends {
  width:160px;
  background: var(--panel);
  border-right:1px solid #ccc;
  overflow-y:auto;
  padding:10px;
}
.friend {
  padding:10px; margin-bottom:6px; border-radius:8px; border:1px solid #ccc;
  background:#f9f9f9; cursor:pointer; transition: background 0.2s, border-color 0.2s;
}
.friend:hover{ background:#e0f0ff; border-color: var(--blue); }
.friend.active{ background:#d0e4ff; border-color: var(--blue); }

#chat-container{
  flex:1; display:flex; flex-direction:column; background:#f0f4fc;
}
#chat-header{ padding:12px; font-weight:700; background:#d0e0fc; border-bottom:1px solid #ccc; }
#chat-body{ flex:1; padding:12px; overflow-y:auto; display:flex; flex-direction:column; gap:10px; }
.msg{ max-width:70%; padding:10px 14px; border-radius:12px; word-break:break-word; position:relative; box-shadow:0 2px 6px rgba(0,0,0,0.03);}
.left{ background:#fff; align-self:flex-start; }
.right{ background:var(--blue); color:#fff; align-self:flex-end; }
.system{ background:#cce0ff; color:#0055aa; text-align:center; align-self:center; font-size:14px; border-radius:6px; padding:6px 10px; }
.time{ font-size:12px; color:var(--muted); margin-bottom:4px; }

#email-full {
  display: none;
  position: fixed;
  right:5%; bottom:50px;
  width:90%; max-width:480px; max-height:80vh;
  overflow-y:auto; background:#fff;
  border:2px solid #3c2814; border-radius:8px; padding:16px; font-size:14px; z-index:1000;
}
#email-full button{ margin-top:12px; padding:8px 12px; border:none; border-radius:6px; background:var(--blue); color:#fff; cursor:pointer; }
</style>
</head>
<body>

<div id="friends">
  <h3>好友列表</h3>
  <div class="friend active">小徐</div>
  <div class="friend">宝宝</div>
  <div class="friend">LNsa陈</div>
  <div class="friend">万物永远</div>
  <div class="friend">小缘宝贝</div>
</div>

<div id="chat-container">
  <div id="chat-header">小徐</div>
  <div id="chat-body"></div>
</div>

<!-- 邮件完整内容 -->
<div id="email-full">
  <h3>关于宝亚保健有限公司运营调整与VIP服务说明（紧急）</h3>
  <p>发件人：service@baoya-health.com<br>收件人：[收件人邮箱]</p>
  <p>各位尊敬的VIP会员：</p>
  <p>您好！首先感谢您一直以来对宝亚保健的支持与信任。我们在此向您通报一则紧急事务。</p>
  <p>由于近期公司遭遇不可逆的资金链断裂，宝亚保健有限公司已无法维持目前运营规模，现阶段公司财务处于极度困难状态。为了保护广大会员的基本权益并尽快进行善后处置，公司决定立即暂停所有线下活动与VIP服务，并启动会员权益保护程序。</p>
  <p>请您务必注意以下事项：</p>
  <ul>
    <li><strong>若您近期有预约或参加活动，请暂停一切线下行程。</strong></li>
  </ul>
  <p>在此特殊时期，给您带来的不便我们深表歉意，感谢您的理解与配合。</p>
  <p>宝亚保健有限公司<br>客户服务部-小徐</p>
  <button onclick="closeEmail()">关闭</button>
</div>

<script>
const chatBody = document.getElementById('chat-body');
const emailFull = document.getElementById('email-full');

/* 玩家消息 */
const playerPanicMessages = [
  "我妈妈不见了！",
  "一定是那个 VIP 游的事，我看到她邮箱里的邮件了。",
  "为什么她不跟我打个招呼啊？",
  "对不起，我还是没能拦下她……",
  "我要去雾山。你能给我个具体地图吗？",
  "王老板一定是要干最后一票，他没什么好失去的了，我要去阻止他！"
];

/* 小徐回复 */
const xiaoxuReplies = [
  "天呐！你不要着急！",
  "雾山那边路况非常不好，很难进出，你千万别冲动啊！",
  "你走之前得带点装备啊，别莽！",
  "……",
  "算了，我跟你一起去。",
  "你千万不要轻举妄动！",
  "你先别急，我们要把那些参加 VIP 的老人都找到，对吗？",
  "说实话，我和小田、小骏在制作一个钓鱼的官方页面，快做完了，你先别慌。",
  "我们的想法是先通过假官网和一个假官方邮箱，让大家先退出 VIP，然后通知他们家属。",
  "等我们把这些都做好了，再去雾山救人。",
  "我们估计还要半个小时，你趁这会儿冷静一下，顺便买点自卫和登山的装备以防万一。"
];


/* 添加消息 */
function appendMessage(msg){
  const el = document.createElement('div');
  el.className = 'msg ' + (msg.side||'left');
  const t = document.createElement('div');
  t.className='time';
  t.textContent = msg.time||fmtTime(0);
  el.appendChild(t);
  const text = document.createElement('div');
  text.textContent = msg.text;
  el.appendChild(text);
  chatBody.appendChild(el);
  chatBody.scrollTop = chatBody.scrollHeight;
}
/* 时间格式：每分钟三条消息 */
function fmtTime(idx){
    const baseHour = 21;
    const baseMinute = 30;
    const minuteOffset = Math.floor(idx / 3); // 每三条消息 +1分钟
    const totalMinutes = baseMinute + minuteOffset;
    const hh = String(baseHour + Math.floor(totalMinutes / 60)).padStart(2,'0');
    const mm = String(totalMinutes % 60).padStart(2,'0');
    return `${hh}:${mm}`;
}

/* 自动播放剧情 */
/* 自动播放剧情 + 邮件 + 下一章按钮 */
function playStory(){
    let idx = 0;
    function sendNext(){
        if(idx < playerPanicMessages.length){
            appendMessage({time:fmtTime(idx), text:playerPanicMessages[idx], side:'right'});
        } else if(idx - playerPanicMessages.length < xiaoxuReplies.length){
            let repIdx = idx - playerPanicMessages.length;
            appendMessage({time:fmtTime(idx), text:xiaoxuReplies[repIdx], side:'left'});
        } else {
            // 延迟3秒显示邮件
            setTimeout(()=>{
                emailFull.style.display='block';
            }, 3000);
            return;
        }
        idx++;
        setTimeout(sendNext, 1200);
    }
    sendNext();
}

/* 邮件关闭后追加两条消息并显示下一章按钮 */
function closeEmail(){
    emailFull.style.display='none';
    setTimeout(()=>{
        appendMessage({time:'22:12', text:'我们这边好了。', side:'left'});
        appendMessage({time:'22:13', text:'我也准备好了。', side:'right'});
        showNextWushanButton();
    }, 800);
}

/* 创建“下一章：WUSHAN”按钮 */
function showNextWushanButton(){
    if(document.querySelector('.glow-button.next-chapter')) return; // 防重复
    const btn = document.createElement('button');
    btn.textContent = '下一章：WUSHAN';
    btn.className = 'glow-button next-chapter';
    btn.style.position = 'absolute';
    btn.style.left = '50%';
    btn.style.top = '50%';
    btn.style.transform = 'translate(-50%, -50%)';
    btn.style.zIndex = 9999;
    btn.style.padding = '16px 32px';
    btn.style.fontSize = '1.4em';
    btn.style.boxShadow = '0 0 24px rgba(255,255,255,0.95), 0 0 48px rgba(255,255,255,0.7)';
    btn.onclick = ()=> window.location.href='6wushan.html';
    document.body.appendChild(btn);
}


/* 启动剧情 */
window.addEventListener('DOMContentLoaded', playStory);
</script>

</body>
</html>
